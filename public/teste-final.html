<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Teste Final de Integra√ß√£o</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 { color: #667eea; margin-bottom: 30px; text-align: center; }
        .steps {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }
        .step {
            padding: 20px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .step h2 { color: #333; margin-bottom: 10px; font-size: 1.2em; }
        .step p { color: #666; margin-bottom: 15px; }
        .btn { padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .result { margin-top: 10px; padding: 10px; border-radius: 4px; font-size: 0.9em; }
        .result.ok { background: #d1fae5; color: #065f46; }
        .result.error { background: #fee2e2; color: #7f1d1d; }
        .links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 8px;
        }
        .link-btn {
            padding: 15px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            text-align: center;
            transition: 0.3s;
        }
        .link-btn:hover { background: #5568d3; transform: translateY(-2px); }
    </style>
</head>
<body>

<div class="container">
    <h1>‚úÖ Teste Final - Admin ‚Üî Loja P√∫blica</h1>

    <div class="steps">
        <div class="step">
            <h2>1Ô∏è‚É£ Verificar Servidor</h2>
            <p>Certifique-se de que o servidor Node.js est√° rodando em http://localhost:3333</p>
            <button class="btn btn-primary" onclick="testServer()">üîå Testar Conex√£o</button>
            <div id="step1-result"></div>
        </div>

        <div class="step">
            <h2>2Ô∏è‚É£ Listar Produtos Atuais</h2>
            <p>Ver todos os produtos cadastrados no banco de dados</p>
            <button class="btn btn-primary" onclick="listProducts()">üì¶ Carregar Produtos</button>
            <div id="step2-result"></div>
        </div>

        <div class="step">
            <h2>3Ô∏è‚É£ Criar Produto de Teste</h2>
            <p>Criar um novo produto para testar a sincroniza√ß√£o Admin ‚Üí Loja</p>
            <button class="btn btn-success" onclick="createTestProduct()">‚ûï Criar Produto Teste</button>
            <div id="step3-result"></div>
        </div>

        <div class="step">
            <h2>4Ô∏è‚É£ Verificar na Loja P√∫blica</h2>
            <p>Abrir a loja e verificar se o produto aparece</p>
            <button class="btn btn-primary" onclick="window.open('http://localhost:3333/', '_blank')">üè† Abrir Loja</button>
            <div id="step4-result"></div>
        </div>

        <div class="step">
            <h2>5Ô∏è‚É£ Gerenciar via Admin</h2>
            <p>Ir para o painel administrativo e criar/editar produtos</p>
            <button class="btn btn-primary" onclick="window.open('http://localhost:3333/admin/produtos.html', '_blank')">üîß Abrir Admin</button>
            <div id="step5-result"></div>
        </div>
    </div>

    <div style="background: #f0f4ff; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="color: #667eea; margin-bottom: 10px;">üìã Fluxo de Integra√ß√£o</h3>
        <ol style="color: #333; line-height: 1.8;">
            <li><strong>Admin cria produto</strong> ‚Üí Vai em üîß Novo Produto</li>
            <li><strong>Preenche formul√°rio</strong> ‚Üí Nome, pre√ßo, imagem, ativa checkbox</li>
            <li><strong>Clica Salvar</strong> ‚Üí Produto vai para banco de dados</li>
            <li><strong>Loja se atualiza</strong> ‚Üí F5 ou espere 1 segundo</li>
            <li><strong>Produto aparece!</strong> ‚Üí Na grade de "Ofertas Imperd√≠veis"</li>
        </ol>
    </div>

    <h2 style="color: #667eea; margin: 30px 0 15px;">üîó Links R√°pidos</h2>
    <div class="links">
        <a href="http://localhost:3333/" target="_blank" class="link-btn">üè† Loja P√∫blica</a>
        <a href="http://localhost:3333/admin/produtos.html" target="_blank" class="link-btn">üîß Admin Produtos</a>
        <a href="http://localhost:3333/teste-integracao.html" target="_blank" class="link-btn">üß™ Teste Integra√ß√£o</a>
        <a href="http://localhost:3333/debug.html" target="_blank" class="link-btn">üîç Debug Console</a>
    </div>
</div>

<script>
async function testServer() {
    const result = document.getElementById('step1-result');
    result.innerHTML = '‚è≥ Testando...';
    
    try {
        const resp = await fetch('http://localhost:3333/api/health');
        if (resp.ok) {
            const data = await resp.json();
            result.innerHTML = `<div class="result ok">‚úÖ Servidor ONLINE! Status: ${data.status}</div>`;
        } else {
            result.innerHTML = `<div class="result error">‚ùå Erro: HTTP ${resp.status}</div>`;
        }
    } catch (e) {
        result.innerHTML = `<div class="result error">‚ùå Servidor OFFLINE: ${e.message}</div>`;
    }
}

async function listProducts() {
    const result = document.getElementById('step2-result');
    result.innerHTML = '‚è≥ Carregando...';
    
    try {
        const resp = await fetch('http://localhost:3333/api/products');
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        
        const products = await resp.json();
        const active = products.filter(p => p.active);
        
        if (products.length === 0) {
            result.innerHTML = `<div class="result error">‚ö†Ô∏è Nenhum produto cadastrado</div>`;
        } else {
            let html = `<div class="result ok">‚úÖ ${products.length} produto(s) ‚Ä¢ ${active.length} ativo(s)<br><br>`;
            products.slice(0, 3).forEach(p => {
                html += `‚Ä¢ ${p.name} - R$ ${p.priceCurrent} (${p.active ? '‚úÖ' : '‚ùå'})<br>`;
            });
            if (products.length > 3) html += `... e mais ${products.length - 3}`;
            html += `</div>`;
            result.innerHTML = html;
        }
    } catch (e) {
        result.innerHTML = `<div class="result error">‚ùå Erro: ${e.message}</div>`;
    }
}

async function createTestProduct() {
    const result = document.getElementById('step3-result');
    result.innerHTML = '‚è≥ Criando...';
    
    try {
        const testProduct = {
            name: `üß™ Teste ${new Date().toLocaleTimeString()}`,
            description: 'Produto criado automaticamente para teste',
            category: 'canetas',
            priceOld: 99.90,
            priceCurrent: 49.90,
            discount: 50,
            image: '/assets/img/produto-placeholder.jpg',
            stock: 100,
            active: true
        };
        
        const resp = await fetch('http://localhost:3333/api/products', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(testProduct)
        });
        
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const result_data = await resp.json();
        
        result.innerHTML = `<div class="result ok">
            ‚úÖ Produto criado com sucesso!<br>
            <strong>ID:</strong> ${result_data.id}<br>
            <strong>Nome:</strong> ${result_data.name}<br>
            <small>Verifique na loja em 1 segundo...</small>
        </div>`;
    } catch (e) {
        result.innerHTML = `<div class="result error">‚ùå Erro: ${e.message}</div>`;
    }
}

// Teste autom√°tico ao carregar
window.addEventListener('load', () => {
    testServer();
});
</script>

</body>
</html>
