<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seed de Produtos - Extreme Sport Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary:#00ff00; --dark:#0a0a0a; --panel:#1a1a1a; --text:#fff; }
    body{margin:0;font-family:'Roboto',sans-serif;background:var(--dark);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{background:var(--panel);border:2px solid var(--primary);border-radius:16px;max-width:680px;width:100%;padding:28px;box-shadow:0 0 30px rgba(0,255,0,.25)}
    h1{font-family:'Bebas Neue',sans-serif;letter-spacing:2px;color:var(--primary);margin:0 0 6px}
    p{opacity:.85;margin:.25rem 0 1rem}
    .status{background:rgba(0,255,0,.08);border:1px dashed var(--primary);padding:12px;border-radius:10px;margin:12px 0;white-space:pre-wrap}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .btn{appearance:none;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--primary);color:#000}
    .btn-ghost{background:transparent;border:1px solid var(--primary);color:var(--text)}
    .hint{font-size:.9rem;opacity:.8;margin-top:10px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="card">
    <h1>Seed de Produtos</h1>
    <p>Popula o banco com 9 produtos iniciais. Recomendado executar apenas uma vez.</p>

    <div id="guardMsg" class="status hidden"></div>
    <div id="status" class="status">Verificando sess√£o...</div>

    <div class="row">
      <button id="btnSeed" class="btn btn-primary" disabled>Inserir 9 produtos</button>
      <a class="btn btn-ghost" href="painel.html">Voltar ao painel</a>
    </div>
    <div class="hint">Aten√ß√£o: este seed usa imagens j√° hospedadas no site em <code>/img</code>. Voc√™ pode editar depois pelo painel para enviar novas imagens ao Storage.</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../config/supabase.js"></script>
  <script>
    const statusEl = document.getElementById('status');
    const guardEl = document.getElementById('guardMsg');
    const btn = document.getElementById('btnSeed');

    const produtosSeed = [
      { nome: 'Chuteira Profissional Branca', descricao: 'Chuteira de alta performance para campo', preco: 349.90, emoji: '‚öΩ', imagem_url: 'img/chuteiraBranca.png', destaque: true, estoque: 12 },
      { nome: 'Chuteira Performance Verde', descricao: 'Conforto e tra√ß√£o para jogo intenso', preco: 389.90, emoji: '‚öΩ', imagem_url: 'img/chuteiraVerde.png', destaque: true, estoque: 10 },
      { nome: 'Kit Chuteiras Premium', descricao: 'Conjunto completo para treino e jogo', preco: 699.90, emoji: 'üëü', imagem_url: 'img/chuteiras.png', destaque: true, estoque: 8 },
      { nome: 'Luva de Goleiro Pro', descricao: 'Prote√ß√£o e ader√™ncia m√°ximas', preco: 179.90, emoji: 'üß§', imagem_url: 'img/luvaGoleiro.png', destaque: true, estoque: 15 },
      { nome: 'Par de Luvas Goleiro Elite', descricao: 'Tecnologia anti-impacto e grip superior', preco: 299.90, emoji: 'ü•Ö', imagem_url: 'img/luvasGoleiro.png', destaque: true, estoque: 9 },
      { nome: 'Camisa Esportiva Premium', descricao: 'Tecido Dry-Fit respir√°vel', preco: 149.90, emoji: 'üëî', imagem_url: 'img/modeloCamisa.png', destaque: true, estoque: 20 },
      { nome: 'Camisa Treino Profissional', descricao: 'Design moderno e alta durabilidade', preco: 139.90, emoji: 'üëï', imagem_url: 'img/modeloCamisa2.png', destaque: true, estoque: 18 },
      { nome: 'Skate Profissional', descricao: 'Skate completo para manobras radicais', preco: 499.90, emoji: 'üõπ', imagem_url: null, destaque: false, estoque: 5 },
      { nome: 'Capacete Extreme', descricao: 'Prote√ß√£o m√°xima para esportes radicais', preco: 299.90, emoji: '‚õëÔ∏è', imagem_url: null, destaque: false, estoque: 7 },
    ];

    async function init() {
      // Sess√£o
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        statusEl.textContent = 'Voc√™ n√£o est√° autenticado. Fa√ßa login em /admin.';
        guardEl.classList.add('hidden');
        return;
      }

      // Verificar admin e role
      const { data: admin, error } = await supabase
        .from('admins')
        .select('role')
        .eq('id', session.user.id)
        .single();

      if (error || !admin) {
        statusEl.textContent = 'Acesso negado: usu√°rio n√£o √© administrador.';
        return;
      }

      if (admin.role !== 'super_admin') {
        guardEl.textContent = 'Apenas super_admin pode executar o seed.';
        guardEl.classList.remove('hidden');
        statusEl.textContent = 'Pronto para visualizar, mas sem permiss√£o para semear.';
        return;
      }

      // Se j√° houver produtos, n√£o habilitar
      const { data: existentes, error: countErr } = await supabase
        .from('produtos')
        .select('id', { count: 'exact', head: true });

      if (countErr) {
        statusEl.textContent = 'Erro ao verificar produtos: ' + countErr.message;
        return;
      }

      const { count } = await supabase
        .from('produtos')
        .select('*', { count: 'exact', head: true });

      if (count && count > 0) {
        statusEl.textContent = `J√° existem ${count} produto(s) no banco. Seed n√£o √© necess√°rio.`;
        return;
      }

      statusEl.textContent = 'Nenhum produto encontrado. Voc√™ pode inserir os 9 produtos.';
      btn.disabled = false;
    }

    btn.addEventListener('click', async () => {
      btn.disabled = true;
      statusEl.textContent = 'Inserindo produtos...';
      try {
        const { error } = await supabase.from('produtos').insert(produtosSeed);
        if (error) throw error;
        statusEl.textContent = '‚úÖ 9 produtos inseridos com sucesso! V√° at√© Produtos no painel para conferir.';
      } catch (e) {
        statusEl.textContent = 'Erro ao inserir: ' + (e.message || e);
        btn.disabled = false;
      }
    });

    init();
  </script>
</body>
</html>
